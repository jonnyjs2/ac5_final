<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Park Map</title>
    <!-- Load Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha2016-ej3L+R0tI9Q+8W75t8l1W3tY2/s4l2+1E4L5r8M+S4Y="
        crossorigin=""/>
    <!-- Load Tailwind CSS for modern styling (e.g., the info box) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Set the map container size */
        #map {
            height: 100vh;
            width: 100%;
        }
        /* Custom styling for the hover tooltip/popup */
        .leaflet-tooltip.park-tooltip {
            background-color: #f7fafc; /* light grey background */
            border: 2px solid #38a169; /* green border */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 8px;
            pointer-events: none; /* Allows clicks to go through to the map below */
        }
        .leaflet-tooltip-bottom:before, .leaflet-tooltip-top:before {
            border-top-color: #38a169;
        }
    </style>
</head>
<body class="font-sans antialiased">

    <div id="map"></div>

    <!-- Load Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha2016-ej3L+R0tI9Q+8W75t8l1W3tY2/s4l2+1E4L5r8M+S4Y="
        crossorigin=""></script>

    <!-- The main logic is now in a standard script block -->
    <script>
        // Check for the special content path variable for GeoJSON files.
        // This ensures the files load both in this editor and on GitHub (where it defaults to './').
        const BASE_PATH = typeof __fs_content_fetch_url_base__ !== 'undefined' ? __fs_content_fetch_url_base__ : './';
        
        /**
         * Utility function to fetch and parse a GeoJSON file.
         * @param {string} fileName - The name of the GeoJSON file (e.g., 'parks.geojson').
         * @returns {Promise<object>} The parsed GeoJSON object.
         */
        async function loadGeoJson(fileName) {
            const filePath = BASE_PATH + fileName;
            try {
                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error(`Could not load GeoJSON file ${filePath}:`, error);
                // Return an empty FeatureCollection if loading fails
                return { type: "FeatureCollection", features: [] };
            }
        }

        /**
         * Initializes the map after all GeoJSON data has been loaded.
         */
        async function initMap() {
            // Load both files concurrently
            const [neighborhoodsData, parksData] = await Promise.all([
                loadGeoJson('neighborhoods.geojson'),
                loadGeoJson('parks.geojson')
            ]);
            
            // --- 1. INITIALIZE MAP ---
            const map = L.map('map').setView([47.6062, -122.3321], 12); // Centered near Seattle

            // Add a base tile layer (OpenStreetMap)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);
            
            // Define the default style for all park features
            function parkStyle(feature) {
                return {
                    fillColor: '#38A169', // Primary park green
                    weight: 2,
                    opacity: 1,
                    color: 'white',
                    dashArray: '3',
                    fillOpacity: 0.7
                };
            }

            // --- 2. PARKS LAYER WITH HOVER FEATURE (Tooltip) ---
            let parksLayer;

            /**
             * Function executed for every single feature in the parks GeoJSON layer.
             * Sets up the interactive hover tooltip and styling.
             */
            function onEachParkFeature(feature, layer) {
                // Get data from GeoJSON properties
                const name = feature.properties.NAME || 'Unnamed Green Space';
                // Assuming PARKSBND_AREA is in square feet, convert to acres
                const area = feature.properties.PARKSBND_AREA ? 
                            `${(feature.properties.PARKSBND_AREA / 43560).toFixed(2)} acres` : 
                            'Area Unknown';

                // Create the content for the hover tooltip using Tailwind classes
                const tooltipContent = `
                    <div class="park-tooltip-content">
                        <span class="text-lg text-green-700">${name}</span><br/>
                        <span class="text-sm text-gray-600">Area: ${area}</span>
                    </div>
                `;

                // Bind a permanent tooltip that is initially hidden by CSS opacity
                layer.bindTooltip(tooltipContent, {
                    permanent: true,     
                    direction: 'top',    
                    className: 'park-tooltip opacity-0 transition-opacity duration-200' 
                });

                // Add event listeners for hover interaction
                layer.on({
                    mouseover: (e) => {
                        // Show tooltip
                        e.target.getTooltip().getElement().style.opacity = '1';
                        // Highlight feature
                        e.target.setStyle({ fillColor: '#68D391', fillOpacity: 0.8 }); 
                    },
                    mouseout: (e) => {
                        // Hide tooltip
                        e.target.getTooltip().getElement().style.opacity = '0';
                        // Revert style
                        parksLayer.resetStyle(e.target);
                    },
                    click: (e) => {
                        // Example: Add a popup on click for more persistent info
                        L.popup()
                            .setLatLng(e.latlng)
                            .setContent(`<h3>${name}</h3><p>Area: ${area}</p>`)
                            .openOn(map);
                    }
                });
            }


            // Load the Parks GeoJSON Layer
            parksLayer = L.geoJSON(parksData, {
                style: parkStyle,
                onEachFeature: onEachParkFeature
            }).addTo(map);
            
            // Check if any features were successfully loaded before attempting to fit bounds
            if (parksData.features && parksData.features.length > 0) {
                 // Fit the map bounds to the parks layer so they are all visible
                map.fitBounds(parksLayer.getBounds());
            } else {
                console.warn("Parks data failed to load features. Setting default view.");
            }
           

            // --- 3. NEIGHBORHOODS LAYER ---
            
            if (neighborhoodsData.features && neighborhoodsData.features.length > 0) {
                 L.geoJSON(neighborhoodsData, {
                    style: function (feature) {
                        return {
                            fillColor: '#4A5568', // Dark grey for boundaries
                            weight: 1,
                            opacity: 0.5,
                            color: '#2D3748',
                            fillOpacity: 0.05 // Very light fill
                        };
                    }
                }).addTo(map);
            } else {
                console.warn("Neighborhoods data failed to load features.");
            }
        }

        // Start the map initialization process when the script loads
        initMap();

    </script>
</body>
</html>
